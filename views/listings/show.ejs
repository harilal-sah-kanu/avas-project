<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/show.css">

<div class="property-page">
    <!-- Property Header -->
    <div class="page-header">
        <div class="page-width">
            <h1 class="property-name"><%= post.title %></h1>
        </div>
    </div>

    <!-- Image Gallery -->
    <% const allImages = post.images && post.images.length > 0 ? post.images : (post.image ? [post.image] : [{url: '/images/placeholder.jpg'}]); %>
    <div class="gallery-container">
        <div class="page-width">
            <div class="image-grid">
                <% if (allImages.length === 1) { %>
                    <div class="img-main-single" data-bs-toggle="modal" data-bs-target="#imageModal" data-index="0">
                        <img src="<%= allImages[0].url %>" alt="<%= post.title %>">
                    </div>
                <% } else if (allImages.length >= 2) { %>
                    <div class="img-main" data-bs-toggle="modal" data-bs-target="#imageModal" data-index="0">
                        <img src="<%= allImages[0].url %>" alt="<%= post.title %>">
                    </div>
                    <div class="img-grid-side">
                        <% const sideImagesCount = Math.min(allImages.length - 1, 4); %>
                        <% for (let i = 1; i <= sideImagesCount; i++) { %>
                            <div class="img-side-item <%= i === 4 && allImages.length > 5 ? 'has-more' : '' %>" 
                                 data-bs-toggle="modal" data-bs-target="#imageModal" data-index="<%= i %>">
                                <img src="<%= allImages[i].url %>" alt="<%= post.title %>">
                                <% if (i === 4 && allImages.length > 5) { %>
                                    <div class="more-overlay">
                                        <i class="fa-solid fa-images"></i>
                                        <span>+<%= allImages.length - 5 %></span>
                                    </div>
                                <% } %>
                            </div>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content-wrapper">
        <div class="page-width">
            <div class="content-grid">
                <!-- Left Column -->
                <div class="content-main">
                    <!-- About Section -->
                    <section class="content-section">
                        <h2 class="section-title">
                            <i class="fa-solid fa-door-open"></i>
                            About this property
                        </h2>
                        <div class="property-details-meta">
                            <span class="detail-item">
                                <i class="fa-solid fa-location-dot"></i>
                                <%= post.location %>, <%= post.country %>
                            </span>
                            <span class="meta-separator">•</span>
                            <span class="detail-item">
                                <i class="fa-solid fa-tag"></i>
                                <%= post.category %>
                            </span>
                            <span class="meta-separator">•</span>
                            <span class="detail-item">
                                <i class="fa-solid fa-user-circle"></i>
                                Hosted by <%= post.owner.username %>
                            </span>
                        </div>
                        <p class="about-text"><%= post.description %></p>
                    </section>

                    <!-- Amenities Section -->
                    <section class="content-section">
                        <h2 class="section-title">
                            <i class="fa-solid fa-star"></i>
                            What this place offers
                        </h2>
                        <div class="amenities-list">
                            <div class="amenity">
                                <i class="fa-solid fa-wifi"></i>
                                <div>
                                    <div class="amenity-title">Free WiFi</div>
                                    <div class="amenity-subtitle">High-speed internet access</div>
                                </div>
                            </div>
                            <div class="amenity">
                                <i class="fa-solid fa-shield-halved"></i>
                                <div>
                                    <div class="amenity-title">Security</div>
                                    <div class="amenity-subtitle">24/7 CCTV & Guards</div>
                                </div>
                            </div>
                            <div class="amenity">
                                <i class="fa-solid fa-utensils"></i>
                                <div>
                                    <div class="amenity-title">Meals Included</div>
                                    <div class="amenity-subtitle">Breakfast & Dinner</div>
                                </div>
                            </div>
                            <div class="amenity">
                                <i class="fa-solid fa-headset"></i>
                                <div>
                                    <div class="amenity-title">24/7 Support</div>
                                    <div class="amenity-subtitle">Always available to help</div>
                                </div>
                            </div>
                            <div class="amenity">
                                <i class="fa-solid fa-bed"></i>
                                <div>
                                    <div class="amenity-title">Clean Rooms</div>
                                    <div class="amenity-subtitle">Daily housekeeping</div>
                                </div>
                            </div>
                            <div class="amenity">
                                <i class="fa-solid fa-square-parking"></i>
                                <div>
                                    <div class="amenity-title">Free Parking</div>
                                    <div class="amenity-subtitle">Secure parking area</div>
                                </div>
                            </div>
                            <div class="amenity">
                                <i class="fa-solid fa-wind"></i>
                                <div>
                                    <div class="amenity-title">Air Conditioning</div>
                                    <div class="amenity-subtitle">Climate controlled</div>
                                </div>
                            </div>
                            <div class="amenity">
                                <i class="fa-solid fa-tv"></i>
                                <div>
                                    <div class="amenity-title">Entertainment</div>
                                    <div class="amenity-subtitle">TV & Streaming services</div>
                                </div>
                            </div>
                            <% if (post.features && post.features.length) { %>
                                <% post.features.forEach(function(feature) { %>
                                    <div class="amenity">
                                        <i class="fa-solid fa-check-circle"></i>
                                        <div>
                                            <div class="amenity-title"><%= feature %></div>
                                        </div>
                                    </div>
                                <% }) %>
                            <% } %>
                        </div>
                    </section>
                </div>

               
                <!-- Right Column - Sticky Booking -->
                <div class="content-sidebar">
                    <div class="booking-card">
                        <!-- Price Section -->
                        <div class="price-section">
                            <div class="price-row">
                                <span class="price-value">₹<%= post.price.toLocaleString("en-IN") %></span>
                                <span class="price-label">per night</span>
                            </div>
                            <div class="tax-row">
                                <i class="fa-solid fa-info-circle"></i>
                                <span>+18% GST</span>
                            </div>
                        </div>

                        <!-- Calendar Section -->
                        <div class="calendar-section">
                            <h3 class="calendar-title">
                                <i class="fa-solid fa-calendar-days"></i>
                                Select your dates
                            </h3>
                            
                            <% if (typeof bookedDates !== 'undefined' && bookedDates.length > 0) { %>
                                <div class="booking-alert">
                                    <i class="fa-solid fa-circle-info"></i>
                                    <span><%= bookedDates.length %> date range(s) currently booked</span>
                                </div>
                            <% } %>

                            <!-- Month Calendar -->
                            <div class="month-calendar">
                                <div class="calendar-header">
                                    <button type="button" class="nav-btn" id="prevMonth">
                                        <i class="fa-solid fa-chevron-left"></i>
                                    </button>
                                    <h4 id="currentMonthYear"></h4>
                                    <button type="button" class="nav-btn" id="nextMonth">
                                        <i class="fa-solid fa-chevron-right"></i>
                                    </button>
                                </div>

                                <div class="calendar-legend">
                                    <div class="legend-item">
                                        <span class="legend-box available"></span>
                                        <span>Available</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-box selected"></span>
                                        <span>Selected</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-box booked"></span>
                                        <span>Booked</span>
                                    </div>
                                </div>

                                <div class="weekdays">
                                    <div>Sun</div>
                                    <div>Mon</div>
                                    <div>Tue</div>
                                    <div>Wed</div>
                                    <div>Thu</div>
                                    <div>Fri</div>
                                    <div>Sat</div>
                                </div>
                                <div class="calendar-grid" id="calendarDaysGrid"></div>

                                <div id="selectedDatesDisplay" class="date-display" style="display: none;">
                                    <div class="date-info">
                                        <div class="date-label">Check-in</div>
                                        <div id="displayCheckIn" class="date-value">-</div>
                                    </div>
                                    <i class="fa-solid fa-arrow-right"></i>
                                    <div class="date-info">
                                        <div class="date-label">Check-out</div>
                                        <div id="displayCheckOut" class="date-value">-</div>
                                    </div>
                                    <div class="date-info">
                                        <div class="date-label">Nights</div>
                                        <div id="displayNights" class="date-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Booking Summary -->
                        <form method="POST" action="/listings/<%= post._id %>/book" id="bookingForm">
                            <input type="hidden" id="checkInDate" name="checkIn" required>
                            <input type="hidden" id="checkOutDate" name="checkOut" required>
                            
                            <div class="booking-summary" id="bookingSummary" style="display: none;">
                                <div class="summary-line">
                                    <span>Total nights:</span>
                                    <span id="totalNights">0</span>
                                </div>
                                <div class="summary-line">
                                    <span>Price per night:</span>
                                    <span>₹<%= post.price.toLocaleString("en-IN") %></span>
                                </div>
                                <div class="summary-line">
                                    <span>Subtotal:</span>
                                    <span id="subtotalPrice">₹0</span>
                                </div>
                                <div class="summary-line">
                                    <span>Tax (18% GST):</span>
                                    <span id="taxAmount">₹0</span>
                                </div>
                                <div class="summary-total">
                                    <span>Total:</span>
                                    <span id="totalPrice">₹0</span>
                                </div>
                                <% if (currUser) { %>
                                    <button type="submit" class="btn-book">
                                        <i class="fa-solid fa-check"></i>
                                        Book Now
                                    </button>
                                <% } else { %>
                                    <a href="/login" class="btn-book">
                                        <i class="fa-solid fa-right-to-bracket"></i>
                                        Login to Book
                                    </a>
                                <% } %>
                            </div>
                        </form>

                        <!-- Owner Actions -->
                        <% if (currUser && post.owner && currUser._id.equals(post.owner._id)) { %>
                            <div class="owner-actions">
                                <a href="/listings/<%= post.id %>/edit" class="btn-action btn-edit">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                    Edit Listing
                                </a>
                                <form method="POST" action="/listings/<%= post.id %>?_method=DELETE" 
                                      onsubmit="return confirm('Delete this listing? All bookings will be cancelled.')">
                                    <button type="submit" class="btn-action btn-delete">
                                        <i class="fa-solid fa-trash-can"></i>
                                        Delete Listing
                                    </button>
                                </form>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Things to Know Section -->
    <div class="full-width-section">
        <div class="page-width">
            <section class="content-section">
                <h2 class="section-title">
                    <i class="fa-solid fa-circle-info"></i>
                    Things to know
                </h2>
                <div class="info-grid">
                    <div class="info-box">
                        <h4 class="info-box-title">House rules</h4>
                        <div class="info-item">
                            <i class="fa-solid fa-clock"></i>
                            <span>Check-in after 2:00 PM</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-clock"></i>
                            <span>Check-out before 11:00 AM</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-users"></i>
                            <span>Suitable for all ages</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-ban-smoking"></i>
                            <span>No smoking allowed</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-paw"></i>
                            <span>Pets allowed with prior approval</span>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4 class="info-box-title">Safety & property</h4>
                        <div class="info-item">
                            <i class="fa-solid fa-shield-halved"></i>
                            <span>Security cameras on property</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-fire-extinguisher"></i>
                            <span>Fire extinguisher available</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-kit-medical"></i>
                            <span>First aid kit provided</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-door-open"></i>
                            <span>Emergency exits clearly marked</span>
                        </div>
                    </div>
                    <div class="info-box">
                        <h4 class="info-box-title">Cancellation policy</h4>
                        <div class="info-item">
                            <i class="fa-solid fa-calendar-xmark"></i>
                            <span>Free cancellation up to 48 hours</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-indian-rupee-sign"></i>
                            <span>50% refund within 24-48 hours</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-ban"></i>
                            <span>No refund within 24 hours</span>
                        </div>
                        <div class="info-item">
                            <i class="fa-solid fa-receipt"></i>
                            <span>Full payment required at booking</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Recommended Properties Section -->
    <div class="full-width-section">
        <div class="page-width">
            <section class="content-section">
                <h2 class="section-title">
                    <i class="fa-solid fa-lightbulb"></i>
                    Recommended properties in <%= post.location %>
                </h2>
                <div class="recommendations-grid">
                    <div class="recommendation-item">
                        <i class="fa-solid fa-utensils"></i>
                        <div>
                            <div class="rec-title">Restaurants</div>
                            <div class="rec-desc">15+ dining options within 1 km</div>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <div>
                            <div class="rec-title">Shopping</div>
                            <div class="rec-desc">Market and mall nearby</div>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <i class="fa-solid fa-hospital"></i>
                        <div>
                            <div class="rec-title">Medical</div>
                            <div class="rec-desc">Hospital within 2 km</div>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <i class="fa-solid fa-bus"></i>
                        <div>
                            <div class="rec-title">Transport</div>
                            <div class="rec-desc">Bus stop 500m away</div>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <i class="fa-solid fa-landmark"></i>
                        <div>
                            <div class="rec-title">Attractions</div>
                            <div class="rec-desc">Tourist spots within 5 km</div>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <i class="fa-solid fa-tree"></i>
                        <div>
                            <div class="rec-title">Parks</div>
                            <div class="rec-desc">Green spaces for relaxation</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="reviews-wrapper">
        <div class="page-width">
            <div class="reviews-container">
                <div class="reviews-header-section">
                    <h2 class="section-title">
                        <i class="fa-solid fa-star"></i>
                        Guest reviews
                    </h2>
                    <% if (post.reviews.length > 0) { %>
                        <% 
                            const totalReviews = post.reviews.length;
                            const avgRating = (post.reviews.reduce((sum, r) => sum + r.rating, 0) / totalReviews).toFixed(1);
                        %>
                        <div class="rating-summary">
                            <div class="rating-score">
                                <div class="score-number"><%= avgRating %></div>
                                <div class="score-stars">
                                    <% for (let i = 1; i <= 5; i++) { %>
                                        <i class="fa-<%= i <= Math.round(avgRating) ? 'solid' : 'regular' %> fa-star"></i>
                                    <% } %>
                                </div>
                                <div class="score-count"><%= totalReviews %> <%= totalReviews === 1 ? 'review' : 'reviews' %></div>
                            </div>
                        </div>
                    <% } %>
                </div>

                <% if (post.reviews.length === 0) { %>
                    <div class="no-reviews-box">
                        <div class="no-reviews-icon">
                            <i class="fa-regular fa-comment-dots"></i>
                        </div>
                        <h3>No reviews yet</h3>
                        <p>This place is brand new! Be the first guest to leave a review.</p>
                    </div>
                <% } else { %>
                    <div class="reviews-list">
                        <% post.reviews.forEach((review) => { %>
                            <div class="review-item">
                                <div class="review-item-header">
                                    <div class="reviewer-avatar">
                                        <i class="fa-solid fa-user-circle"></i>
                                    </div>
                                    <div class="reviewer-details">
                                        <div class="reviewer-name"><%= review.author ? review.author.username : 'Anonymous' %></div>
                                        <div class="review-stars">
                                            <% for (let i = 1; i <= 5; i++) { %>
                                                <i class="fa-<%= i <= review.rating ? 'solid' : 'regular' %> fa-star"></i>
                                            <% } %>
                                        </div>
                                    </div>
                                    <% if (currUser && review.author && currUser._id.equals(review.author._id)) { %>
                                        <form action="/listings/<%= post._id %>/reviews/<%= review._id %>?_method=DELETE" method="post" class="delete-review-form">
                                            <button type="submit" class="btn-delete-review-icon" title="Delete review">
                                                <i class="fa-solid fa-trash-can"></i>
                                            </button>
                                        </form>
                                    <% } %>
                                </div>
                                <p class="review-item-text"><%= review.comment %></p>
                            </div>
                        <% }) %>
                    </div>
                <% } %>

                <% if (currUser) { %>
                    <div class="review-form-section">
                        <h3 class="form-section-title">Share your experience</h3>
                        <form method="post" action="/listings/<%= post.id %>/reviews" novalidate class="needs-validation review-form">
                            <div class="form-row">
                                <div class="form-field">
                                    <label class="field-label">Your Rating</label>
                                    <fieldset class="starability-slot">
                                        <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
                                        <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                                        <label for="first-rate1" title="Terrible"></label>
                                        <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                                        <label for="first-rate2" title="Not good"></label>
                                        <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                                        <label for="first-rate3" title="Average"></label>
                                        <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                                        <label for="first-rate4" title="Very good"></label>
                                        <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                                        <label for="first-rate5" title="Amazing"></label>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="form-field">
                                <label for="comment" class="field-label">Your Review</label>
                                <textarea name="review[comment]" id="comment" rows="5" class="field-textarea" required 
                                          placeholder="Tell us about your stay - what did you love? What could be improved?"></textarea>
                                <div class="field-helper">Help others by sharing your honest experience</div>
                            </div>
                            <button type="submit" class="btn-submit-review">
                                <i class="fa-solid fa-paper-plane"></i>
                                Submit Review
                            </button>
                        </form>
                    </div>
                <% } else { %>
                    <div class="login-prompt">
                        <i class="fa-solid fa-user-lock"></i>
                        <p>Please <a href="/login">sign in</a> to leave a review</p>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <button type="button" class="btn-close modal-close-btn" data-bs-dismiss="modal"></button>
            <div class="modal-body">
                <div id="imageModalCarousel" class="carousel slide">
                    <div class="carousel-inner">
                        <% allImages.forEach((img, index) => { %>
                            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                <img src="<%= img.url %>" class="d-block w-100" alt="<%= post.title %>">
                            </div>
                        <% }) %>
                    </div>
                    <% if (allImages.length > 1) { %>
                        <button class="carousel-control-prev" type="button" data-bs-target="#imageModalCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#imageModalCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/calendarCart.js"></script>
<script>
    // Calendar & Booking Logic
    let currentDate = new Date();
    let selectedCheckIn = null;
    let selectedCheckOut = null;
    const TAX_RATE = 0.18;
    const pricePerNight = <%= post.price %>;
    const listingId = '<%= post._id %>';

    // Fetch booked dates
    fetch(`/listings/${listingId}/booked-dates`)
        .then(res => res.json())
        .then(data => { window.bookedRanges = data.bookedRanges || []; renderCalendar(); })
        .catch(err => console.error(err));

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
        document.getElementById('currentMonthYear').textContent = `${monthNames[month]} ${year}`;
        
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const grid = document.getElementById('calendarDaysGrid');
        grid.innerHTML = '';
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        for (let i = 0; i < firstDay; i++) {
            grid.innerHTML += '<div class="day empty"></div>';
        }
        
        for (let day = 1; day <= daysInMonth; day++) {
            const dayDate = new Date(year, month, day);
            dayDate.setHours(0, 0, 0, 0);
            const isPast = dayDate < today;
            const isBooked = window.bookedRanges && window.bookedRanges.some(range => {
                const start = new Date(range.checkIn);
                const end = new Date(range.checkOut);
                start.setHours(0, 0, 0, 0);
                end.setHours(0, 0, 0, 0);
                return dayDate >= start && dayDate < end;
            });
            
            let classes = 'day';
            if (isPast) classes += ' past';
            else if (isBooked) classes += ' booked';
            else classes += ' available';
            
            if (selectedCheckIn && dayDate.getTime() === selectedCheckIn.getTime()) classes += ' selected';
            if (selectedCheckOut && dayDate.getTime() === selectedCheckOut.getTime()) classes += ' selected';
            if (selectedCheckIn && selectedCheckOut && dayDate > selectedCheckIn && dayDate < selectedCheckOut) classes += ' in-range';
            
            const dayEl = `<div class="${classes}" data-date="${dayDate.toISOString().split('T')[0]}">${day}</div>`;
            grid.innerHTML += dayEl;
        }
        
        document.querySelectorAll('.day.available').forEach(el => {
            el.addEventListener('click', () => selectDate(new Date(el.dataset.date)));
        });
    }

    function selectDate(date) {
        if (!selectedCheckIn || (selectedCheckIn && selectedCheckOut)) {
            selectedCheckIn = date;
            selectedCheckOut = null;
            document.getElementById('checkInDate').value = date.toISOString().split('T')[0];
            document.getElementById('checkOutDate').value = '';
        } else if (date > selectedCheckIn) {
            selectedCheckOut = date;
            document.getElementById('checkOutDate').value = date.toISOString().split('T')[0];
        } else {
            selectedCheckOut = null;
            selectedCheckIn = date;
            document.getElementById('checkInDate').value = date.toISOString().split('T')[0];
            document.getElementById('checkOutDate').value = '';
        }
        updateDisplay();
        renderCalendar();
    }

    function updateDisplay() {
        const display = document.getElementById('selectedDatesDisplay');
        const summary = document.getElementById('bookingSummary');
        
        if (selectedCheckIn) {
            display.style.display = 'flex';
            const opts = { month: 'short', day: 'numeric' };
            document.getElementById('displayCheckIn').textContent = selectedCheckIn.toLocaleDateString('en-US', opts);
            
            if (selectedCheckOut) {
                document.getElementById('displayCheckOut').textContent = selectedCheckOut.toLocaleDateString('en-US', opts);
                // Calculate nights: difference in days between check-out and check-in
                const timeDiff = selectedCheckOut.getTime() - selectedCheckIn.getTime();
                const nights = Math.round(timeDiff / (1000 * 60 * 60 * 24));
                document.getElementById('displayNights').textContent = nights;
                
                const subtotal = nights * pricePerNight;
                const tax = subtotal * TAX_RATE;
                const total = subtotal + tax;
                
                document.getElementById('totalNights').textContent = nights;
                document.getElementById('subtotalPrice').textContent = '₹' + subtotal.toLocaleString('en-IN');
                document.getElementById('taxAmount').textContent = '₹' + Math.round(tax).toLocaleString('en-IN');
                document.getElementById('totalPrice').textContent = '₹' + Math.round(total).toLocaleString('en-IN');
                summary.style.display = 'block';
            } else {
                document.getElementById('displayCheckOut').textContent = '-';
                document.getElementById('displayNights').textContent = '-';
                summary.style.display = 'none';
            }
        } else {
            display.style.display = 'none';
            summary.style.display = 'none';
        }
    }

    document.getElementById('prevMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    });

    document.getElementById('bookingForm')?.addEventListener('submit', function(e) {
        if (!document.getElementById('checkInDate').value || !document.getElementById('checkOutDate').value) {
            e.preventDefault();
            alert('Please select check-in and check-out dates');
        }
    });

    document.addEventListener('DOMContentLoaded', renderCalendar);
</script>
